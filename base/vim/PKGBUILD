#!/bin/bash

pkgname=vim
pkgver=7.4.2152
archive=v$pkgver.tar.gz
sum=afcc1a57ff4cd35323ee5502c6c214e2acdc50ea
dstdir=$mkToolchainBase

pagerver=2.06
pagerarchive=$pagerver.tar.gz
pagersum=4aa7feed1843e0b2554dd5110fbf031ba0889f9d

build() {
  download https://github.com/vim/vim/archive/$archive
  check $archive $sum
  extract $archive

  pushd $pkgname-$pkgver
    message "Configuring $pkgname"
    ./configure --prefix="$dstdir" --with-compiledby="$PKGVERSION" \
                --disable-nls --disable-sysmouse --disable-gui --with-x=no \
                --disable-selinux --enable-multibyte --with-features=huge \
                --enable-cscope --disable-netbeans --disable-workshop \
                --enable-perlinterp --enable-pythoninterp \
                --disable-python3interp --enable-tclinterp \
                --with-tclsh=$(which tclsh) --enable-luainterp \
                --with-lua-prefix="$mkToolchainBase"
    message "Compiling $pkgname"
    make
  popd

  download https://github.com/rkitover/vimpager/archive/$pagerarchive
  check $pagerarchive $pagersum
  extract $pagerarchive
}

package() {
  make -C $pkgname-$pkgver install
  make -C vimpager-$pagerver PREFIX="$dstdir" SYSCONFDIR="$dstdir"/etc install
  sed -i "s:/usr/bin/nawk:$mkToolchainBase/bin/nawk:g" \
    "$dstdir"/share/vim/vim74/tools/mve.awk
}
