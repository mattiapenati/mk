#!/bin/bash

pkgname=bash
pkgver=4.3
archive=$pkgname-$pkgver.tar.gz
sum=45ac3c5727e7262334f4dfadecdf601b39434e84

dstdir=$mkToolchainBase

build() {
  download http://ftpmirror.gnu.org/$pkgname/$archive
  check $archive $sum
  extract $archive

  pushd $pkgname-$pkgver
    message "Applying patches to $pkgname"
    for patch in {1..39}; do
      patchfile=$pkgname${pkgver//.}-$(printf "%03d" $patch)
      download http://ftpmirror.gnu.org/$pkgname/$pkgname-$pkgver-patches/$patchfile
      patch -p0 -i "$srcdir"/$patchfile
    done
    message "Configuring $pkgname"
    ./configure --build=$TARGET --prefix="$dstdir" --without-bash-malloc \
                --with-curses --enable-readline --with-installed-readline \
                --disable-nls
    message "Compiling $pkgname"
    make
  popd
}

package() {
  make -C $pkgname-$pkgver install
  rm -rf "$dstdir"/share/doc
  compress_doc "$dstdir"/share/info/bash.info
  compress_doc "$dstdir"/share/man/man1/{bash,bashbug}.1
  strip "$dstdir"/bin/bash
  ln -sf bash "$dstdir"/bin/sh
}
