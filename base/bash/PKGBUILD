#!/bin/bash

pkgname=bash
pkgver=4.3
patchlevel=30
archive=$pkgname-$pkgver.$patchlevel.tar.gz
sum=33b1bcc5dca1b72f28b2baeca6efa0d422097964

dstdir=$mkToolchainBase

build() {
  download http://ftpmirror.gnu.org/$pkgname/$archive
  check $archive $sum
  extract $archive

  pushd $pkgname-$pkgver.$patchlevel
    # download and apply the patch
    message "Applying patches to $pkgname"
    for patch in {31..46}; do
      patchfile=$pkgname${pkgver//.}-$(printf "%03d" $patch)
      download http://ftpmirror.gnu.org/$pkgname/$pkgname-$pkgver-patches/$patchfile
      patch -p0 -i "$srcdir"/$patchfile
    done
    message "Configuring $pkgname"
    ./configure --build=$TARGET --prefix="$dstdir" \
      --without-bash-malloc --disable-nls --with-installed-readline
    message "Compiling $pkgname"
    make
  popd
}

package() {
  make -C $pkgname-$pkgver.$patchlevel install
  ln -sv bash $dstdir/bin/sh
}
